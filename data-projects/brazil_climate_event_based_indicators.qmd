---
title: "Event-based climate indicators for public health analysis"
bibliography: references.bib
---

## Introduction

Climate and health research has traditionally represented environmental exposure using nominal meteorological variables, such as mean temperature or total precipitation, included as continuous covariates in epidemiological models. Although these indicators are widely available and straightforward to implement, they often inadequately represent the persistent, extreme, and threshold-exceeding conditions through which climate variability and change affect human health. Many health impacts are driven by discrete climate events - such as heat waves, cold spells, prolonged rainfall, and dry spells - whose effects depend on duration, intensity, and temporal clustering rather than on average conditions alone.

I propose here a method to compute, for each Brazilian municipality, a monthly or weekly set of event-based climate indicators and climatological normals.

::: callout-tip
In a hurry? Jump to the [download](#sec-download) section ;-)
:::

## Methods

A climatological normal can be computed with data from different sources, including remote sensing sensors and "area averages or points in gridded datasets" [@wmoWMOGuidelinesCalculation2017]. Some gridded climatological datasets are available for the Brazilian territory, including the ERA5-Land from Copernicus [@muñoz-sabater2021] and the BR-DWGD dataset [@xavier2022], offering several climatological indicators for a long time range, and continuously updates.

Some research methods demands that climate data must be aggregated in the same spatial and temporal units of other data to be used in statistical models, being a fairly common procedure in epidemiology and economy studies. In order to approach this issue, spatial gridded data can be aggregated using *zonal statistics* [@saldanhaZonalStatisticsDatasets2024].

For this dataset, climate zonal statistics from ERA5-Land for the Brazilian municipalities (described [here](https://rfsaldanha.github.io/data-projects/brazil-climate-zonal-indicators.html#zonal-era5-land)) was used to compute climatological normals and monthly/weekly event indicators.

To compute the event-based indicators and the climatologial normals, an R package named [{climindi}](https://rfsaldanha.github.io/climindi) was created. The package provides helper functions to compute climatological normals and event-based climate indicators in a [tidy](https://www.tidyverse.org) way.

### Normal indicators

The {climindi} package computes the average, 10th and 90th percentile as climatological normals.

Two climatologial normals were computed: 1961-1990 and 1981-2010.

### Event-based indicators

Considering each climatological normal, a set of event-based indicators was computed using the {climindi} package for maximum and minimum temperature, total precipitation, average relative humidity and average wind speed.

For each climate indicator, a set of standard indicators and a set of specific indicators were computed. 

#### Standard indicators

-  `count` Count of data points
-  `mean` Mean value
-  `median` Median
-  `sd` Standard deviation
-  `se` Standard error
-  `max` Maximum value
-  `min` Minimum value
-  `p10` 10th percentile
-  `p25` 25th percentile
-  `p75` 75th percentile
-  `p90` 90th percentile

#### Specific indicators

-   Precipitation
    -   `rs3` Rain spells: count of rain spells occurrences, with 3 and 5 or more consecutive days with rain above the climatological normal average value
    -  `p_1` Count of days with precipitation above 1mm
    -  `p_5` Count of days with precipitation above 5mm
    -  `p_10` Count of days with precipitation above 10mm
    -  `p_50` Count of days with precipitation above 50mm
    -  `p_100` Count of days with precipitation above 100mm
    -   `d_3` Count of sequences of 3 days or more without precipitation
    -   `d_5` Count of sequences of 5 days or more without precipitation
    -   `d_10` Count of sequences of 10 days or more without precipitation
    -   `d_15` Count of sequences of 15 days or more without precipitation
    -   `d_20` Count of sequences of 20 days or more without precipitation
    -   `d_25` Count of sequences of 25 days or more without precipitation
-   Maximum temperature
    -   `hw3` Count of heat waves occurrences with 3 or more consecutive days with maximum temperature above the climatological normal value plus 5 Celsius degrees
    -   `hw5` Count of heat waves occurrences with 5 or more consecutive days with maximum temperature above the climatological normal value plus 5 Celsius degrees
    -   `hot_days` Count of hot days, when the maximum temperature is above the normal 90th percentile
    -   `t_25` Count of days with temperatures above or equal to 25 Celsius degrees
    -   `t_30` Count of days with temperatures above or equal to 30 Celsius degrees 
    -   `t_35` Count of days with temperatures above or equal to 35 Celsius degrees 
    -   `t_40` Count of days with temperatures above or equal to 40 Celsius degrees
-   Minimum temperature
    -   `cw3` Count of cold spells occurrences with 3 or more consecutive days with minimum temperature bellow the climatological normal value minus 5 Celsius degrees
    -   `cw5` Count of cold spells occurrences with 5 or more consecutive days with minimum temperature bellow the climatological normal value minus 5 Celsius degrees
    -   `cold_days` Count of cold days, when the minimum temperature is bellow the normal 10th percentile
    -   `t_0` Count of days with temperatures bellow or equal to 0 Celsius degrees
    -   `t_5` Count of days with temperatures bellow or equal to 5 Celsius degrees
    -   `t_10` Count of days with temperatures bellow or equal to 10 Celsius degrees
    -   `t_15` Count of days with temperatures bellow or equal to 15 Celsius degrees
    -   `t_20` Count of days with temperatures bellow or equal to 20 Celsius degrees
-   Relative humidity
    -   `ds3` Count of dry spells occurrences with 3 or more consecutive days with relative humidity bellow the climatological normal value minus 10 percent
    -   `ds5` Count of dry spells occurrences with 5 or more consecutive days with relative humidity bellow the climatological normal value minus 10 percent
    -   `ws3` Count of wet spells occurrences with 3 or more consecutive days with relative humidity above the climatological normal value plus 10 percent
    -   `ws5` Count of wet spells occurrences with 5 or more consecutive days with relative humidity above the climatological normal value plus 10 percent
    -   `dry_days` Count of dry days, when the relative humidity is bellow the normal 10th percentile
    -   `wet_days` Count of wet days, when the relative humidity is above the normal 90th percentile
    -   `h_21_30` Count of days with relative humidity between 21% and 30% (Attention level)
    -   `h_12_20` Count of days with relative humidity between 12% and 20% (Alert level)
    -   `h_11` Count of days with relative humidity bellow 12% (Emergence level)
-   Wind speed
    -   `l_eto_3` Count of sequences of 3 or more consecutive days with wind speed bellow the climatological average normal
    -   `l_eto_5` Count of sequences of 5 or more consecutive days with wind speed bellow the climatological average normal
    -   `h_eto_3` Count of sequences of 3 or more consecutive days with wind speed above the climatological average normal
    -   `h_eto_5` Count of sequences of 5 or more consecutive days with wind speed above the climatological average normal
    -  `b1` Count of days classified as level 1 on Beaufort scale
    -  `b2` Count of days classified as level 2 on Beaufort scale
    -  `b3` Count of days classified as level 3 on Beaufort scale
    -  `b4` Count of days classified as level 4 on Beaufort scale
    -  `b5` Count of days classified as level 5 on Beaufort scale
    -  `b6` Count of days classified as level 6 on Beaufort scale
    -  `b7` Count of days classified as level 7 on Beaufort scale
    -  `b8` Count of days classified as level 8 on Beaufort scale
    -  `b9` Count of days classified as level 9 on Beaufort scale
    -  `b10` Count of days classified as level 10 on Beaufort scale
    -  `b11` Count of days classified as level 11 on Beaufort scale
    -  `b12` Count of days classified as level 12 on Beaufort scale

::: callout-important
The package functions needs data in specific units. Please certify that your data is in the required unit before running the functions.
:::

The code used to compute this dataset is available [here](https://github.com/rfsaldanha/climate_event_based_events).

## Dataset download {#sec-download}

The climatological normals and event-based indicators be downloaded from Zenodo on CSV and parquet formats. Click the link bellow to access and download the data.

[![](https://img.shields.io/badge/download-10.5281/zenodo.18612340-green.svg)](https://doi.org/10.5281/zenodo.18612340)

You can also download the dataset directly from R, using the [{zendown}](https://rfsaldanha.github.io/zendown/) package.

## Results preview

Let's check some results using the monthly datasets and the 1981-2010 climatological normal.

```{r}
#| message: false
#| warning: false
#| code-fold: true

library(dplyr)
library(lubridate)
library(arrow)
library(zendown) # https://rfsaldanha.github.io/zendown/
```

### Maximum temperature, Rio de Janeiro, RJ, 2024

#### Observed and normal

```{r}
#| message: false
#| warning: false
#| code-fold: true

# 2024 data
tmax_data <- zen_file(15748125, "2m_temperature_max.parquet") |>
  open_dataset() |>
  filter(name == "2m_temperature_max_mean") |>
  filter(code_muni == 3304557) |>
  select(-name) |>
  mutate(value = round(value - 273.15, digits = 2)) |>
  collect()

#  normals
tmax_normal <- zen_file(18612340, "tmax_monthly_normal_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 3304557) |>
  collect()
```

```{r}
#| message: false
#| warning: false
#| classes: preview-image
#| code-fold: true
library(ggplot2)
library(tidyr)

# Prepare data for graph
tmax_normal_exp <- tmax_normal |>
  mutate(date = as_date(paste0("2024-", month, "-01"))) |>
  group_by(month) %>%
  expand(
    date = seq.Date(
      floor_date(date, unit = "month"),
      ceiling_date(date, unit = "month") - days(1),
      by = "day"
    ),
    normal_mean,
    normal_p10,
    normal_p90
  ) |>
  pivot_longer(cols = starts_with("normal_")) |>
  mutate(name = substr(name, 8, 100))

# Plot
ggplot() +
  geom_line(data = tmax_data, aes(x = date, y = value)) +
  geom_line(data = tmax_normal_exp, aes(x = date, y = value, color = name)) +
  theme_bw() +
  labs(
    title = "Maximum temperatures and monthly climatological normals",
    subtitle = "Rio de Janeiro, RJ",
    color = "Normal (1981-2010)",
    x = "Date",
    y = "Celsius degrees"
  ) +
  theme(legend.position = "bottom", legend.direction = "horizontal")
```

```{r}
#| message: false
#| warning: false
#| classes: preview-image
#| code-fold: true

#  normals
tmax_normal <- zen_file(18612340, "tmax_weekly_normal_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 3304557) |>
  collect()

tmax_normal_exp <- tmax_normal |>
  filter_out(week == 53) |>
  mutate(date = as.Date(paste(2024, week, 1, sep = "-"), "%Y-%U-%u")) |>
  group_by(week) %>%
  expand(
    date = seq.Date(
      floor_date(date, unit = "week"),
      ceiling_date(date, unit = "week") - days(1),
      by = "day"
    ),
    normal_mean,
    normal_p10,
    normal_p90
  ) |>
  pivot_longer(cols = starts_with("normal_")) |>
  mutate(name = substr(name, 8, 100))

# Plot
ggplot() +
  geom_line(data = tmax_data, aes(x = date, y = value)) +
  geom_line(data = tmax_normal_exp, aes(x = date, y = value, color = name)) +
  theme_bw() +
  labs(
    title = "Maximum temperatures and weekly climatological normals, 2024",
    subtitle = "Rio de Janeiro, RJ",
    color = "Normal (1981-2010)",
    x = "Date",
    y = "Celsius degrees"
  ) +
  theme(legend.position = "bottom", legend.direction = "horizontal")
```

#### Indicators

```{r}
#| message: false
#| warning: false
#| code-fold: true
library(gt)

# Load event-based indicators and filter for 2024
zen_file(18612340, "tmax_monthly_indi_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 3304557) |>
  filter(year == 2024) |>
  select(-code_muni, -year) |>
  collect() |>
  gt() |>
  fmt_number(
    columns = where(is.double),
    decimals = 2,
    use_seps = FALSE
  )
```

### Minimum temperature, Urupema, SC, 2025

#### Observed and normal

```{r}
#| message: false
#| warning: false
#| code-fold: true

# 2025 data
tmin_data <- zen_file(18257037, "2m_temperature_min.parquet") |>
  open_dataset() |>
  filter(name == "2m_temperature_min_mean") |>
  filter(code_muni == 4218954) |>
  select(-name) |>
  mutate(value = round(value - 273.15, digits = 2)) |>
  collect()

# normals
tmin_normal <- zen_file(18612340, "tmin_monthly_normal_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 4218954) |>
  collect()
```

```{r}
#| message: false
#| warning: false
#| classes: preview-image
#| code-fold: true
library(ggplot2)
library(tidyr)

# Prepare data for graph
tmin_normal_exp <- tmin_normal |>
  mutate(date = as_date(paste0("2025-", month, "-01"))) |>
  group_by(month) %>%
  expand(
    date = seq.Date(
      floor_date(date, unit = "month"),
      ceiling_date(date, unit = "month") - days(1),
      by = "day"
    ),
    normal_mean,
    normal_p10,
    normal_p90
  ) |>
  pivot_longer(cols = starts_with("normal_")) |>
  mutate(name = substr(name, 8, 100))

# Plot
ggplot() +
  geom_line(data = tmin_data, aes(x = date, y = value)) +
  geom_line(data = tmin_normal_exp, aes(x = date, y = value, color = name)) +
  theme_bw() +
  labs(
    title = "Minimum temperatures and monthly climatological normals, 2025",
    subtitle = "Urupema, SC",
    color = "Normal (1981-2010)",
    x = "Date",
    y = "Celsius degrees"
  ) +
  theme(legend.position = "bottom", legend.direction = "horizontal")
```

#### Indicators

```{r}
#| message: false
#| warning: false
#| code-fold: true
library(gt)

# Load event-based indicators and filter for 2024
zen_file(18612340, "tmin_monthly_indi_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 4218954) |>
  filter(year == 2025) |>
  select(-code_muni, -year) |>
  collect() |>
  gt() |>
  fmt_number(
    columns = where(is.double),
    decimals = 2,
    use_seps = FALSE
  )
```

### Relative humidity, Aquidauana, MS, 2025

#### Observed and normal

```{r}
#| message: false
#| warning: false
#| code-fold: true

# 2025 data
rh_data <- zen_file(18392587, "rh_mean_mean_2025.parquet") |>
  open_dataset() |>
  filter(name == "rh_mean_mean") |>
  filter(code_muni == 5001102) |>
  select(-name) |>
  collect()

# normals
rh_normal <- zen_file(18612340, "rh_normal_monthly_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 5001102) |>
  collect()
```

```{r}
#| message: false
#| warning: false
#| classes: preview-image
#| code-fold: true
library(ggplot2)
library(tidyr)

# Prepare data for graph
rh_normal_exp <- rh_normal |>
  mutate(date = as_date(paste0("2025-", month, "-01"))) |>
  group_by(month) %>%
  expand(
    date = seq.Date(
      floor_date(date, unit = "month"),
      ceiling_date(date, unit = "month") - days(1),
      by = "day"
    ),
    normal_mean,
    normal_p10,
    normal_p90
  ) |>
  pivot_longer(cols = starts_with("normal_")) |>
  mutate(name = substr(name, 8, 100))

# Plot
ggplot() +
  geom_line(data = rh_data, aes(x = date, y = value)) +
  geom_line(data = rh_normal_exp, aes(x = date, y = value, color = name)) +
  theme_bw() +
  labs(
    title = "Relative humidity and monthly climatological normals, 2025",
    subtitle = "Aquidauana, MS",
    color = "Normal (1981-2010)",
    x = "Date",
    y = "%"
  ) +
  theme(legend.position = "bottom", legend.direction = "horizontal")
```

#### Indicators

```{r}
#| message: false
#| warning: false
#| code-fold: true
library(gt)

# Load event-based indicators and filter for 2024
zen_file(18612340, "rh_indi_monthly_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 5001102) |>
  filter(year == 2025) |>
  select(-code_muni, -year) |>
  collect() |>
  gt() |>
  fmt_number(
    columns = where(is.double),
    decimals = 2,
    use_seps = FALSE
  )
```

### Precipitation, Calçoene, AP, 2025

#### Observed and normal

```{r}
#| message: false
#| warning: false
#| code-fold: true

# 2025 data
prec_data <- zen_file(18257037, "total_precipitation_sum.parquet") |>
  open_dataset() |>
  filter(name == "total_precipitation_sum_mean") |>
  filter(code_muni == 1600204) |>
  mutate(value = round(value * 1000, digits = 2)) |>
  select(-name) |>
  collect()

# normals
prec_normal <- zen_file(18612340, "prec_monthly_normal_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 1600204) |>
  collect()
```

```{r}
#| message: false
#| warning: false
#| classes: preview-image
#| code-fold: true
library(ggplot2)
library(tidyr)

# Prepare data for graph
prec_normal_exp <- prec_normal |>
  mutate(date = as_date(paste0("2025-", month, "-01"))) |>
  group_by(month) %>%
  expand(
    date = seq.Date(
      floor_date(date, unit = "month"),
      ceiling_date(date, unit = "month") - days(1),
      by = "day"
    ),
    normal_mean,
    normal_p10,
    normal_p90
  ) |>
  pivot_longer(cols = starts_with("normal_")) |>
  mutate(name = substr(name, 8, 100))

# Plot
ggplot() +
  geom_line(data = prec_data, aes(x = date, y = value)) +
  geom_line(data = prec_normal_exp, aes(x = date, y = value, color = name)) +
  theme_bw() +
  labs(
    title = "Precipitation and monthly climatological normals, 2025",
    subtitle = "Calçoene, AP",
    color = "Normal (1981-2010)",
    x = "Date",
    y = "mm"
  ) +
  theme(legend.position = "bottom", legend.direction = "horizontal")
```

#### Indicators

```{r}
#| message: false
#| warning: false
#| code-fold: true
library(gt)

# Load event-based indicators and filter for 2024
zen_file(18612340, "prec_monthly_indi_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 5001102) |>
  filter(year == 2025) |>
  select(-code_muni, -year) |>
  collect() |>
  gt() |>
  fmt_number(
    columns = where(is.double),
    decimals = 2,
    use_seps = FALSE
  )
```

### Wind speed, Caetité, BA, 2025

#### Observed and normal

```{r}
#| message: false
#| warning: false
#| code-fold: true

# 2025 data
ws_data <- zen_file(18390794, "wind_speed_mean_mean_2025.parquet") |>
  open_dataset() |>
  filter(name == "wind_speed_mean_mean") |>
  filter(code_muni == 1600204) |>
  select(-name) |>
  collect()

# normals
ws_normal <- zen_file(18612340, "ws_monthly_normal_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 1600204) |>
  collect()
```

```{r}
#| message: false
#| warning: false
#| classes: preview-image
#| code-fold: true
library(ggplot2)
library(tidyr)

# Prepare data for graph
ws_normal_exp <- ws_normal |>
  mutate(date = as_date(paste0("2025-", month, "-01"))) |>
  group_by(month) %>%
  expand(
    date = seq.Date(
      floor_date(date, unit = "month"),
      ceiling_date(date, unit = "month") - days(1),
      by = "day"
    ),
    normal_mean,
    normal_p10,
    normal_p90
  ) |>
  pivot_longer(cols = starts_with("normal_")) |>
  mutate(name = substr(name, 8, 100))

# Plot
ggplot() +
  geom_line(data = ws_data, aes(x = date, y = value)) +
  geom_line(data = ws_normal_exp, aes(x = date, y = value, color = name)) +
  theme_bw() +
  labs(
    title = "Wind speed and monthly climatological normals, 2025",
    subtitle = "Caetité, BA",
    color = "Normal (1981-2010)",
    x = "Date",
    y = "m/s"
  ) +
  theme(legend.position = "bottom", legend.direction = "horizontal")
```

#### Indicators

```{r}
#| message: false
#| warning: false
#| code-fold: true
library(gt)

# Load event-based indicators and filter for 2024
zen_file(18612340, "ws_monthly_indi_n1981_2010.parquet") |>
  open_dataset() |>
  filter(code_muni == 5001102) |>
  filter(year == 2025) |>
  select(-code_muni, -year) |>
  collect() |>
  gt() |>
  fmt_number(
    columns = where(is.double),
    decimals = 2,
    use_seps = FALSE
  )
```

## Session info

```{r}
sessioninfo::session_info()
```